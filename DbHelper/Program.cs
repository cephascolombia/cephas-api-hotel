using System; using System.IO; using Npgsql; using System.Threading.Tasks; class Program { static async Task Main() { await using var conn = new NpgsqlConnection("Host=72.61.70.56;Port=5432;Database=tikkun;Username=admindb;Password=AceroBronce2560*;Timeout=10;SslMode=Prefer"); await conn.OpenAsync(); string drops = @"DROP FUNCTION IF EXISTS public.fn_hotel_s_room_full(integer); DROP FUNCTION IF EXISTS public.fn_hotel_s_rooms_full(integer, integer, character varying, integer, numeric, numeric, character varying); DROP FUNCTION IF EXISTS public.fn_hotel_c_room_amenities_images(character varying, numeric, character varying, integer, character varying, integer[], text[]); DROP FUNCTION IF EXISTS public.fn_hotel_u_room_amenities_images(integer, character varying, numeric, integer, character varying, json, json);"; await using (var cmdDrop = new NpgsqlCommand(drops, conn)) { await cmdDrop.ExecuteNonQueryAsync(); } string[] funcs = { "fn_hotel_c_room_amenities_images", "fn_hotel_u_room_amenities_images", "fn_hotel_s_room_full", "fn_hotel_s_rooms_full" }; foreach(var f in funcs) { await using var cmd = new NpgsqlCommand(await File.ReadAllTextAsync($"{f}.sql"), conn); await cmd.ExecuteNonQueryAsync(); } Console.WriteLine("Updated functions successfully"); } }
